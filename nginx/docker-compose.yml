# Nginx 最小可用的 docker-compose，含静态站点目录与健康检查
version: "3.8" # Compose 文件版本

services:
  # Nginx 服务
  nginx:
    image: nginx:1.25-alpine       # 使用轻量的 Alpine 版本镜像
    container_name: nginx          # 容器名称
    restart: always                # 异常退出或开机自动重启

    # 端口映射：宿主机端口 -> 容器端口
    ports:
      - "80:80"    # HTTP
      - "443:443"  # HTTPS

    # 目录挂载：本地目录映射到容器路径
    volumes:
      - ./html/dist:/usr/share/nginx/html   # 站点静态文件根目录
      - ./logs:/var/log/nginx          # Nginx 访问/错误日志
      - ./conf/nginx.conf/:/etc/nginx/nginx.conf
      - ./certs:/etc/nginx/certs     # 可选：TLS 证书目录（配合 conf.d 的 server 使用）

    # 健康检查：校验 Nginx 配置是否有效
    healthcheck:
      test: ["CMD-SHELL","nginx -t || exit 1"] # 返回非 0 视为不健康
      interval: 30s     # 检查间隔
      timeout: 10s      # 每次检查超时时间
      retries: 3        # 重试次数
      start_period: 5s  # 启动缓冲期
